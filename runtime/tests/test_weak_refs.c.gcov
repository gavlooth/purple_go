        -:    0:Source:test_weak_refs.c
        -:    0:Graph:./run_tests_cov-test_main.gcno
        -:    0:Data:./run_tests_cov-test_main.gcda
        -:    0:Runs:1
        -:    1:/* test_weak_refs.c - Weak reference tests */
        -:    2:#include "test_framework.h"
        -:    3:
        -:    4:/* ========== Weak Reference Creation Tests ========== */
        -:    5:
function test_mk_weak_ref called 1 returned 100% blocks executed 44%
        1:    6:void test_mk_weak_ref(void) {
        1:    7:    int dummy = 42;
        1:    8:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
       1*:    9:    ASSERT_NOT_NULL(w);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:   10:    ASSERT_EQ(w->target, &dummy);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:   11:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   12:    PASS();
call    0 returned 1
        -:   13:}
        -:   14:
function test_mk_weak_ref_null_target called 1 returned 100% blocks executed 46%
        1:   15:void test_mk_weak_ref_null_target(void) {
        1:   16:    _InternalWeakRef* w = _mk_weak_ref(NULL);
call    0 returned 1
       1*:   17:    ASSERT_NOT_NULL(w);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:   18:    ASSERT_NULL(w->target);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:   19:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   20:    PASS();
call    0 returned 1
        -:   21:}
        -:   22:
        -:   23:/* ========== Weak Reference Deref Tests ========== */
        -:   24:
function test_deref_weak_valid called 1 returned 100% blocks executed 67%
        1:   25:void test_deref_weak_valid(void) {
        1:   26:    int dummy = 42;
        1:   27:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
        1:   28:    void* deref = _deref_weak(w);
call    0 returned 1
       1*:   29:    ASSERT_EQ(deref, &dummy);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   30:    PASS();
call    0 returned 1
        -:   31:}
        -:   32:
function test_deref_weak_null called 1 returned 100% blocks executed 67%
        1:   33:void test_deref_weak_null(void) {
        1:   34:    void* deref = _deref_weak(NULL);
call    0 returned 1
       1*:   35:    ASSERT_NULL(deref);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   36:    PASS();
call    0 returned 1
        -:   37:}
        -:   38:
function test_deref_weak_invalidated called 1 returned 100% blocks executed 70%
        1:   39:void test_deref_weak_invalidated(void) {
        1:   40:    int dummy = 42;
        1:   41:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
        1:   42:    _invalidate_weak(w);
call    0 returned 1
        1:   43:    void* deref = _deref_weak(w);
call    0 returned 1
       1*:   44:    ASSERT_NULL(deref);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   45:    PASS();
call    0 returned 1
        -:   46:}
        -:   47:
        -:   48:/* ========== Weak Reference Invalidation Tests ========== */
        -:   49:
function test_invalidate_weak called 1 returned 100% blocks executed 50%
        1:   50:void test_invalidate_weak(void) {
        1:   51:    int dummy = 42;
        1:   52:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
       1*:   53:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   54:    _invalidate_weak(w);
call    0 returned 1
       1*:   55:    ASSERT_EQ(w->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   56:    PASS();
call    0 returned 1
        -:   57:}
        -:   58:
function test_invalidate_weak_null called 1 returned 100% blocks executed 100%
        1:   59:void test_invalidate_weak_null(void) {
        1:   60:    _invalidate_weak(NULL);  /* Should not crash */
call    0 returned 1
        1:   61:    PASS();
call    0 returned 1
        1:   62:}
        -:   63:
function test_invalidate_weak_twice called 1 returned 100% blocks executed 70%
        1:   64:void test_invalidate_weak_twice(void) {
        1:   65:    int dummy = 42;
        1:   66:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
        1:   67:    _invalidate_weak(w);
call    0 returned 1
        1:   68:    _invalidate_weak(w);  /* Should be idempotent */
call    0 returned 1
       1*:   69:    ASSERT_EQ(w->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   70:    PASS();
call    0 returned 1
        -:   71:}
        -:   72:
        -:   73:/* ========== invalidate_weak_refs_for Tests ========== */
        -:   74:
function test_invalidate_weak_refs_for_single called 1 returned 100% blocks executed 50%
        1:   75:void test_invalidate_weak_refs_for_single(void) {
        1:   76:    int dummy = 42;
        1:   77:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
       1*:   78:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   79:    invalidate_weak_refs_for(&dummy);
call    0 returned 1
       1*:   80:    ASSERT_EQ(w->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   81:    PASS();
call    0 returned 1
        -:   82:}
        -:   83:
function test_invalidate_weak_refs_for_multiple called 1 returned 100% blocks executed 50%
        1:   84:void test_invalidate_weak_refs_for_multiple(void) {
        1:   85:    int dummy = 42;
        1:   86:    _InternalWeakRef* w1 = _mk_weak_ref(&dummy);
call    0 returned 1
        1:   87:    _InternalWeakRef* w2 = _mk_weak_ref(&dummy);
call    0 returned 1
        1:   88:    _InternalWeakRef* w3 = _mk_weak_ref(&dummy);
call    0 returned 1
        -:   89:
        1:   90:    invalidate_weak_refs_for(&dummy);
call    0 returned 1
        -:   91:
       1*:   92:    ASSERT_EQ(w1->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:   93:    ASSERT_EQ(w2->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:   94:    ASSERT_EQ(w3->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:   95:    PASS();
call    0 returned 1
        -:   96:}
        -:   97:
function test_invalidate_weak_refs_for_selective called 1 returned 100% blocks executed 53%
        1:   98:void test_invalidate_weak_refs_for_selective(void) {
        1:   99:    int d1 = 1, d2 = 2;
        1:  100:    _InternalWeakRef* w1 = _mk_weak_ref(&d1);
call    0 returned 1
        1:  101:    _InternalWeakRef* w2 = _mk_weak_ref(&d2);
call    0 returned 1
        -:  102:
        1:  103:    invalidate_weak_refs_for(&d1);
call    0 returned 1
        -:  104:
       1*:  105:    ASSERT_EQ(w1->alive, 0);  /* d1 refs invalidated */
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  106:    ASSERT_EQ(w2->alive, 1);  /* d2 refs still alive */
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  107:    PASS();
call    0 returned 1
        -:  108:}
        -:  109:
function test_invalidate_weak_refs_for_null called 1 returned 100% blocks executed 100%
        1:  110:void test_invalidate_weak_refs_for_null(void) {
        1:  111:    invalidate_weak_refs_for(NULL);  /* Should not crash */
call    0 returned 1
        1:  112:    PASS();
call    0 returned 1
        1:  113:}
        -:  114:
        -:  115:/* ========== Weak References with Obj ========== */
        -:  116:
function test_weak_ref_to_obj called 1 returned 100% blocks executed 46%
        1:  117:void test_weak_ref_to_obj(void) {
        1:  118:    Obj* obj = mk_int(42);
call    0 returned 1
        1:  119:    _InternalWeakRef* w = _mk_weak_ref(obj);
call    0 returned 1
       1*:  120:    ASSERT_EQ(w->target, obj);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  121:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        -:  122:
        -:  123:    /* Deref should return the Obj */
        1:  124:    Obj* deref = (Obj*)_deref_weak(w);
call    0 returned 1
       1*:  125:    ASSERT_EQ(deref, obj);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        -:  126:
        1:  127:    dec_ref(obj);
call    0 returned 1
       1*:  128:    ASSERT_EQ(w->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  129:    ASSERT_NULL(_deref_weak(w));
call    0 returned 1
branch  1 taken 0 (fallthrough)
branch  2 taken 1
call    3 never executed
        1:  130:    PASS();
call    0 returned 1
        -:  131:}
        -:  132:
function test_weak_ref_invalidated_on_free called 1 returned 100% blocks executed 64%
        1:  133:void test_weak_ref_invalidated_on_free(void) {
        1:  134:    Obj* obj = mk_int(42);
call    0 returned 1
        1:  135:    _InternalWeakRef* w = _mk_weak_ref(obj);
call    0 returned 1
        -:  136:
        -:  137:    /* free_obj defers to free list; flush to trigger invalidation */
        1:  138:    free_obj(obj);
call    0 returned 1
        1:  139:    flush_freelist();
call    0 returned 1
        -:  140:
       1*:  141:    ASSERT_EQ(w->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  142:    void* deref = _deref_weak(w);
call    0 returned 1
       1*:  143:    ASSERT_NULL(deref);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  144:    PASS();
call    0 returned 1
        -:  145:}
        -:  146:
function test_weak_ref_invalidated_on_dec_ref called 1 returned 100% blocks executed 67%
        1:  147:void test_weak_ref_invalidated_on_dec_ref(void) {
        1:  148:    Obj* obj = mk_int(42);
call    0 returned 1
        1:  149:    _InternalWeakRef* w = _mk_weak_ref(obj);
call    0 returned 1
        -:  150:
        -:  151:    /* dec_ref to zero should invalidate weak refs */
        1:  152:    dec_ref(obj);
call    0 returned 1
        -:  153:
       1*:  154:    ASSERT_EQ(w->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  155:    PASS();
call    0 returned 1
        -:  156:}
        -:  157:
        -:  158:/* ========== Weak References with Pairs ========== */
        -:  159:
function test_weak_ref_to_pair called 1 returned 100% blocks executed 55%
        1:  160:void test_weak_ref_to_pair(void) {
        1:  161:    Obj* pair = mk_pair(mk_int(1), mk_int(2));
call    0 returned 1
call    1 returned 1
call    2 returned 1
        1:  162:    _InternalWeakRef* w = _mk_weak_ref(pair);
call    0 returned 1
        -:  163:
       1*:  164:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  165:    Obj* deref = (Obj*)_deref_weak(w);
call    0 returned 1
       1*:  166:    ASSERT_EQ(deref, pair);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  167:    ASSERT_EQ(deref->tag, TAG_PAIR);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        -:  168:
        1:  169:    dec_ref(pair);
call    0 returned 1
        1:  170:    PASS();
call    0 returned 1
        -:  171:}
        -:  172:
function test_weak_ref_to_nested_pair called 1 returned 100% blocks executed 54%
        1:  173:void test_weak_ref_to_nested_pair(void) {
        1:  174:    Obj* inner = mk_pair(mk_int(1), mk_int(2));
call    0 returned 1
call    1 returned 1
call    2 returned 1
        1:  175:    Obj* outer = mk_pair(inner, mk_int(3));
call    0 returned 1
call    1 returned 1
        1:  176:    _InternalWeakRef* w_outer = _mk_weak_ref(outer);
call    0 returned 1
        1:  177:    _InternalWeakRef* w_inner = _mk_weak_ref(inner);
call    0 returned 1
        -:  178:
       1*:  179:    ASSERT_EQ(w_outer->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  180:    ASSERT_EQ(w_inner->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        -:  181:
        1:  182:    dec_ref(outer);
call    0 returned 1
        -:  183:
        -:  184:    /* Both should be invalidated */
       1*:  185:    ASSERT_EQ(w_outer->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  186:    ASSERT_EQ(w_inner->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  187:    PASS();
call    0 returned 1
        -:  188:}
        -:  189:
        -:  190:/* ========== Weak Reference Registry Tests ========== */
        -:  191:
function test_weak_ref_registry_grows called 1 returned 100% blocks executed 73%
        1:  192:void test_weak_ref_registry_grows(void) {
        1:  193:    _InternalWeakRefNode* old_head = _WEAK_REF_HEAD;
        -:  194:    int dummies[10];
        -:  195:
       11:  196:    for (int i = 0; i < 10; i++) {
branch  0 taken 10
branch  1 taken 1 (fallthrough)
       10:  197:        dummies[i] = i;
       10:  198:        _mk_weak_ref(&dummies[i]);
call    0 returned 10
        -:  199:    }
        -:  200:
        -:  201:    /* Registry should have grown */
       1*:  202:    ASSERT(_WEAK_REF_HEAD != old_head);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  203:    PASS();
call    0 returned 1
        -:  204:}
        -:  205:
        -:  206:/* ========== Stress Tests ========== */
        -:  207:
function test_weak_ref_stress_many_refs called 1 returned 100% blocks executed 61%
        1:  208:void test_weak_ref_stress_many_refs(void) {
        -:  209:    int dummies[100];
        -:  210:    _InternalWeakRef* refs[100];
        -:  211:
      101:  212:    for (int i = 0; i < 100; i++) {
branch  0 taken 100
branch  1 taken 1 (fallthrough)
      100:  213:        dummies[i] = i;
      100:  214:        refs[i] = _mk_weak_ref(&dummies[i]);
call    0 returned 100
     100*:  215:        ASSERT_NOT_NULL(refs[i]);
branch  0 taken 0 (fallthrough)
branch  1 taken 100
call    2 never executed
     100*:  216:        ASSERT_EQ(refs[i]->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 100
call    2 never executed
        -:  217:    }
        -:  218:
        -:  219:    /* Invalidate all */
      101:  220:    for (int i = 0; i < 100; i++) {
branch  0 taken 100
branch  1 taken 1 (fallthrough)
      100:  221:        invalidate_weak_refs_for(&dummies[i]);
call    0 returned 100
     100*:  222:        ASSERT_EQ(refs[i]->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 100
call    2 never executed
        -:  223:    }
        1:  224:    PASS();
call    0 returned 1
        -:  225:}
        -:  226:
function test_weak_ref_stress_many_to_same_target called 1 returned 100% blocks executed 70%
        1:  227:void test_weak_ref_stress_many_to_same_target(void) {
        1:  228:    int dummy = 42;
        -:  229:    _InternalWeakRef* refs[50];
        -:  230:
       51:  231:    for (int i = 0; i < 50; i++) {
branch  0 taken 50
branch  1 taken 1 (fallthrough)
       50:  232:        refs[i] = _mk_weak_ref(&dummy);
call    0 returned 50
        -:  233:    }
        -:  234:
        -:  235:    /* All should be alive */
       51:  236:    for (int i = 0; i < 50; i++) {
branch  0 taken 50
branch  1 taken 1 (fallthrough)
      50*:  237:        ASSERT_EQ(refs[i]->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 50
call    2 never executed
        -:  238:    }
        -:  239:
        -:  240:    /* Invalidate should affect all */
        1:  241:    invalidate_weak_refs_for(&dummy);
call    0 returned 1
        -:  242:
       51:  243:    for (int i = 0; i < 50; i++) {
branch  0 taken 50
branch  1 taken 1 (fallthrough)
      50*:  244:        ASSERT_EQ(refs[i]->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 50
call    2 never executed
        -:  245:    }
        1:  246:    PASS();
call    0 returned 1
        -:  247:}
        -:  248:
function test_weak_ref_stress_with_objs called 1 returned 100% blocks executed 76%
        1:  249:void test_weak_ref_stress_with_objs(void) {
        -:  250:    Obj* objs[100];
        -:  251:    _InternalWeakRef* refs[100];
        -:  252:
      101:  253:    for (int i = 0; i < 100; i++) {
branch  0 taken 100
branch  1 taken 1 (fallthrough)
      100:  254:        objs[i] = mk_int(i);
call    0 returned 100
      100:  255:        refs[i] = _mk_weak_ref(objs[i]);
call    0 returned 100
        -:  256:    }
        -:  257:
        -:  258:    /* Free half - deferred, so flush afterwards */
       51:  259:    for (int i = 0; i < 50; i++) {
branch  0 taken 50
branch  1 taken 1 (fallthrough)
       50:  260:        free_obj(objs[i]);
call    0 returned 50
        -:  261:    }
        1:  262:    flush_freelist();
call    0 returned 1
        -:  263:
        -:  264:    /* First half should be invalidated */
       51:  265:    for (int i = 0; i < 50; i++) {
branch  0 taken 50
branch  1 taken 1 (fallthrough)
      50*:  266:        ASSERT_EQ(refs[i]->alive, 0);
branch  0 taken 0 (fallthrough)
branch  1 taken 50
call    2 never executed
        -:  267:    }
        -:  268:
        -:  269:    /* Second half should still be alive */
       51:  270:    for (int i = 50; i < 100; i++) {
branch  0 taken 50
branch  1 taken 1 (fallthrough)
      50*:  271:        ASSERT_EQ(refs[i]->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 50
call    2 never executed
       50:  272:        dec_ref(objs[i]);
call    0 returned 50
        -:  273:    }
        1:  274:    PASS();
call    0 returned 1
        -:  275:}
        -:  276:
        -:  277:/* ========== Edge Cases ========== */
        -:  278:
function test_weak_ref_deref_after_multiple_invalidations called 1 returned 100% blocks executed 75%
        1:  279:void test_weak_ref_deref_after_multiple_invalidations(void) {
        1:  280:    int dummy = 42;
        1:  281:    _InternalWeakRef* w = _mk_weak_ref(&dummy);
call    0 returned 1
        -:  282:
        1:  283:    _invalidate_weak(w);
call    0 returned 1
        1:  284:    _invalidate_weak(w);
call    0 returned 1
        1:  285:    _invalidate_weak(w);
call    0 returned 1
        -:  286:
        1:  287:    void* deref = _deref_weak(w);
call    0 returned 1
       1*:  288:    ASSERT_NULL(deref);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  289:    PASS();
call    0 returned 1
        -:  290:}
        -:  291:
function test_weak_ref_to_stack_pool_obj called 1 returned 100% blocks executed 50%
        1:  292:void test_weak_ref_to_stack_pool_obj(void) {
        1:  293:    int old_ptr = STACK_PTR;
        1:  294:    Obj* obj = mk_int_stack(42);
call    0 returned 1
        1:  295:    _InternalWeakRef* w = _mk_weak_ref(obj);
call    0 returned 1
        -:  296:
       1*:  297:    ASSERT_EQ(w->target, obj);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  298:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        -:  299:
        -:  300:    /* Stack objects shouldn't be freed normally */
        1:  301:    STACK_PTR = old_ptr;
        1:  302:    PASS();
call    0 returned 1
        -:  303:}
        -:  304:
function test_weak_ref_to_immediate called 1 returned 100% blocks executed 50%
        1:  305:void test_weak_ref_to_immediate(void) {
        1:  306:    Obj* imm = mk_int_unboxed(42);
call    0 returned 1
        1:  307:    _InternalWeakRef* w = _mk_weak_ref(imm);
call    0 returned 1
        -:  308:
        -:  309:    /* Immediates don't have identity but can still be pointed to */
       1*:  310:    ASSERT_EQ(w->target, imm);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
       1*:  311:    ASSERT_EQ(w->alive, 1);
branch  0 taken 0 (fallthrough)
branch  1 taken 1
call    2 never executed
        1:  312:    PASS();
call    0 returned 1
        -:  313:}
        -:  314:
        -:  315:/* ========== Run All Weak Reference Tests ========== */
        -:  316:
function run_weak_refs_tests called 1 returned 100% blocks executed 63%
        1:  317:void run_weak_refs_tests(void) {
        1:  318:    TEST_SUITE("Weak References");
call    0 returned 1
        -:  319:
        1:  320:    TEST_SECTION("Creation");
call    0 returned 1
       1*:  321:    RUN_TEST(test_mk_weak_ref);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  322:    RUN_TEST(test_mk_weak_ref_null_target);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  323:
        1:  324:    TEST_SECTION("Deref");
call    0 returned 1
       1*:  325:    RUN_TEST(test_deref_weak_valid);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  326:    RUN_TEST(test_deref_weak_null);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  327:    RUN_TEST(test_deref_weak_invalidated);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  328:
        1:  329:    TEST_SECTION("Invalidation");
call    0 returned 1
       1*:  330:    RUN_TEST(test_invalidate_weak);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  331:    RUN_TEST(test_invalidate_weak_null);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  332:    RUN_TEST(test_invalidate_weak_twice);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  333:
        1:  334:    TEST_SECTION("invalidate_weak_refs_for");
call    0 returned 1
       1*:  335:    RUN_TEST(test_invalidate_weak_refs_for_single);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  336:    RUN_TEST(test_invalidate_weak_refs_for_multiple);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  337:    RUN_TEST(test_invalidate_weak_refs_for_selective);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  338:    RUN_TEST(test_invalidate_weak_refs_for_null);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  339:
        1:  340:    TEST_SECTION("With Obj");
call    0 returned 1
       1*:  341:    RUN_TEST(test_weak_ref_to_obj);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  342:    RUN_TEST(test_weak_ref_invalidated_on_free);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  343:    RUN_TEST(test_weak_ref_invalidated_on_dec_ref);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  344:
        1:  345:    TEST_SECTION("With Pairs");
call    0 returned 1
       1*:  346:    RUN_TEST(test_weak_ref_to_pair);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  347:    RUN_TEST(test_weak_ref_to_nested_pair);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  348:
        1:  349:    TEST_SECTION("Registry");
call    0 returned 1
       1*:  350:    RUN_TEST(test_weak_ref_registry_grows);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  351:
        1:  352:    TEST_SECTION("Stress Tests");
call    0 returned 1
       1*:  353:    RUN_TEST(test_weak_ref_stress_many_refs);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  354:    RUN_TEST(test_weak_ref_stress_many_to_same_target);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  355:    RUN_TEST(test_weak_ref_stress_with_objs);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        -:  356:
        1:  357:    TEST_SECTION("Edge Cases");
call    0 returned 1
       1*:  358:    RUN_TEST(test_weak_ref_deref_after_multiple_invalidations);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  359:    RUN_TEST(test_weak_ref_to_stack_pool_obj);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
       1*:  360:    RUN_TEST(test_weak_ref_to_immediate);
call    0 returned 1
call    1 returned 1
branch  2 taken 0 (fallthrough)
branch  3 taken 1
branch  4 never executed (fallthrough)
branch  5 never executed
call    6 never executed
        1:  361:}
